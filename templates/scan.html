{% extends "base.html" %}

{% block title %}バーコードスキャン | 飲酒管理アプリ{% endblock %}

{% block content %}
<div class="bg-white bg-opacity-80 backdrop-blur-md shadow-lg rounded-2xl p-6 max-w-md w-full mx-auto">
    <h2 class="text-xl font-bold text-blue-800 mb-4 text-center">バーコードスキャン</h2>
    
    <div id="reader" class="w-full"></div>
    
    <form id="barcode-form" action="/scan" method="get" class="mt-4 hidden">
        <input type="hidden" id="jan_code_input" name="jan_code">
        <p class="text-center text-blue-800">バーコードを読み取りました。送信します...</p>
    </form>

    <div class="mt-4 text-center">
        <a href="/" class="bg-blue-400 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-xl shadow">TOPへ戻る</a>
    </div>
</div>

<!-- html5-qrcode CDN -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<script>
    function onScanSuccess(decodedText, decodedResult) {
        console.log(`スキャン成功: ${decodedText}`);
        document.getElementById("jan_code_input").value = decodedText;
        document.getElementById("barcode-form").submit();
    }

    function onScanError(errorMessage) {
        console.log(`スキャンエラー: ${errorMessage}`);
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", 
        { fps: 10, qrbox: 250 },
        /* verbose= */ false);
    html5QrcodeScanner.render(onScanSuccess, onScanError);
</script>
{% endblock %}